<!doctype html>

<head>


  <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css" integrity="sha384-MCw98/SFnGE8fJT3GXwEOngsV7Zt27NXFoaoApmYm81iuXoPkFOJwJ8ERdknLPMO"
    crossorigin="anonymous">

</head>
<style>
  .wrapper{
      margin: 0 15%;

    }
  </style>

<body>
  <div class="wrapper">
    <div class="jumbotron jumbotron-fluid">
      <div class="container">
        <h1 class="display-4">Train Schedule</h1>
      </div>
    </div>


    <table class="table table-striped" id="Train-Table">
      <thead>
        <tr>
          <th scope="col">Train Name</th>
          <th scope="col">Train Destination</th>
          <th scope="col">Train Frequency(min)</th>
          <th scope="col">Next Arival</th>
          <th scope="col">Minutes Away</th>
        </tr>
      </thead>

    </table>


    <div class="form-group">
      <label for="TrainName-Input"">TrainName</label>
          <input type="text" class="form-control" id="TrainName-Input"" placeholder="Full TrainName">
    </div>
    <div class="form-group">
      <label for="Destination-Input"">Destination</label>
            <input type="text" class="form-control" id="Destination-Input"" placeholder="Destination">
    </div>
    <div class="form-group">
      <label for="FirstTrainTime-Input"">First Train Time (HH:mm - military time)</label>
              <input type="time" class="form-control" id="FirstTrainTime-Input"" placeholder="First Train">
    </div>
    <div class="form-group">
      <label for="Frequency-Input"">Frequency (min)</label>
                <input type="text" class="form-control" id="Frequency-Input"" placeholder="Frequency">
    </div>
    <input class="btn btn-primary" type="submit" value="Submit" id="SubmitButton">

  </div>
</body>

<script src="https://www.gstatic.com/firebasejs/5.5.8/firebase.js"></script>
<script src="https://code.jquery.com/jquery.js"></script>
<script src="https://cdn.jsdelivr.net/momentjs/2.12.0/moment.min.js"></script>
<script>


  // Initialize Firebase
  var config = {
    apiKey: "AIzaSyDwWioHb6896qzfwRG15Alu8wchW_0LiJ0",
    authDomain: "trainschedule-9bff7.firebaseapp.com",
    databaseURL: "https://trainschedule-9bff7.firebaseio.com",
    projectId: "trainschedule-9bff7",
    storageBucket: "trainschedule-9bff7.appspot.com",
    messagingSenderId: "375940381159"
  };
  firebase.initializeApp(config);

  // Create a variable to reference the database

  var database = firebase.database();
  var TrainName, Destination, FirstTrainTime, Frequency;
  var NextArrival, MinutesAway;

  // Capture Button Click
  $("#SubmitButton").on("click", function (event) {


    TrainName = $("#TrainName-Input").val();
    Destination = $("#Destination-Input").val();
    FirstTrainTime = $("#FirstTrainTime-Input").val();
    Frequency = $("#Frequency-Input").val();


    database.ref().push({
      TrainName: TrainName,
      Destination: Destination,
      FirstTrainTime: FirstTrainTime,
      Frequency: Frequency
    });



  });

  database.ref().once('value', function (snapshot) {
    if (snapshot.exists()) {
      var content = '';
      snapshot.forEach(function (data) {
        var val = data.val();
        content += '<tr>';
        content += '<td>' + val.TrainName + '</td>';
        content += '<td>' + val.Destination + '</td>';
        content += '<td>' + val.Frequency + '</td>';
        //next arrival
        content += '<td>' + CaluclateArrival(val.FirstTrainTime, val.Frequency) + '</td>';
        //minutes away
        content += '<td>' + CaluclateMinutesAway(val.FirstTrainTime, val.Frequency) + '</td>';

        content += '</tr>';
      });
      $('#Train-Table').append(content);
    }
  });

  function CaluclateMinutesAway(FirstTrainTime, Frequency) {

    // First Time (pushed back 1 year to make sure it comes before current time)
    var firstTimeConverted = moment(FirstTrainTime, "HH:mm");

    // Current Time
    var currentTime = moment();

    // Difference between the times
    var diffTime = moment().diff(moment(firstTimeConverted), "minutes");

    // Time apart (remainder)
    var tRemainder = diffTime % Frequency;

    // Minute Until Train
    var tMinutesTillTrain = Frequency - tRemainder;


    return tMinutesTillTrain;

  }

  function CaluclateArrival(FirstTrainTime, Frequency) {


    // First Time (pushed back 1 year to make sure it comes before current time)
    var firstTimeConverted = moment(FirstTrainTime, "HH:mm");

    // Current Time
    var currentTime = moment();

    // Difference between the times
    var diffTime = moment().diff(moment(firstTimeConverted), "minutes");

    // Time apart (remainder)
    var tRemainder = diffTime % Frequency;

    // Minute Until Train
    var tMinutesTillTrain = Frequency - tRemainder;

    // Next Train
    var nextTrain = moment().add(tMinutesTillTrain, "minutes");

    return moment(nextTrain).format("hh:mm a");


  }




</script>

</html>